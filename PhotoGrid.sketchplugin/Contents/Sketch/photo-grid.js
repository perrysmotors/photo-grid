var that=this;function __skpm_run(key,context){that.context=context;var exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="./src/photo-grid.js")}({"./src/photo-grid.js":
/*!***************************!*\
  !*** ./src/photo-grid.js ***!
  \***************************/
/*! exports provided: onRandomizeAspectRatios, onFit, onSettings */function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"onRandomizeAspectRatios",function(){return onRandomizeAspectRatios}),__webpack_require__.d(__webpack_exports__,"onFit",function(){return onFit}),__webpack_require__.d(__webpack_exports__,"onSettings",function(){return onSettings});var UI=__webpack_require__(/*! sketch/ui */"sketch/ui"),DOM=__webpack_require__(/*! sketch/dom */"sketch/dom"),Settings=__webpack_require__(/*! sketch/settings */"sketch/settings"),aspectRatios=[1,1.25,4/3,1.4,1.5,16/9,2/3,5/7,.75,.8],options=initOptions(),form={};function initOptions(){var defaults={isRowLayout:!0,padding:16,hasWidthLimit:!1,maxWidth:1200};for(var option in defaults){var value=eval(Settings.settingForKey(option));void 0===value?Settings.setSettingForKey(option,defaults[option]):defaults[option]=value}return defaults}function onRandomizeAspectRatios(t){var e=DOM.getSelectedDocument().selectedLayers;if(0===e.length)UI.message("Select one or more layers");else{var n=getBoundingBox(e.layers);findGroups(e.layers).forEach(function(t){randomizeAspectRatios(t,n)})}}function onFit(t){var e=DOM.getSelectedDocument().selectedLayers;if(0===e.length)UI.message("Select one or more layers");else{var n=getBoundingBox(e.layers),o=findGroups(e.layers);if(options.isRowLayout){options.hasWidthLimit&&(n.width=options.maxWidth);var i=n.y;o.forEach(function(t){fitLayersInRows(t,n,i),i=t[0].sketchObject.absoluteRect().y()+t[0].frame.height+options.padding})}else{var r=n.x;o.forEach(function(t){fitLayersInColumns(t,n,r),r=t[0].sketchObject.absoluteRect().x()+t[0].frame.width+options.padding})}}}function onSettings(t){if("1000"==createDialog().runModal()){var e=form.spacingTextField.stringValue(),n=parseInt(e);isNaN(n)||""===e?UI.message("⚠️ The spacing was not changed. Try entering a number."):n<0||n>1e3?UI.message("⚠️ Enter a spacing value between 0 and 1000"):(options.padding=n,Settings.setSettingForKey("padding",n)),options.isRowLayout=form.rowsRadioButton.state()===NSOnState,Settings.setSettingForKey("isRowLayout",options.isRowLayout),options.hasWidthLimit=form.hasWidthLimitCheckbox.state()===NSOnState,Settings.setSettingForKey("hasWidthLimit",options.hasWidthLimit);var o=form.maxWidthTextField.stringValue(),i=parseInt(o);isNaN(i)||""===o?UI.message("⚠️ The maximum width was not changed. Try entering a number."):i<10||i>1e4?UI.message("⚠️ Enter a maximum width between 10 and 10,000"):(options.maxWidth=i,Settings.setSettingForKey("maxWidth",i))}}function randomizeAspectRatios(t,e){var n,o=e.x,i=e.y;options.isRowLayout?(n=t.sort(function(t,e){return t.sketchObject.absoluteRect().x()-e.sketchObject.absoluteRect().x()}),i=n[0].sketchObject.absoluteRect().y()):(n=t.sort(function(t,e){return t.sketchObject.absoluteRect().y()-e.sketchObject.absoluteRect().y()}),o=n[0].sketchObject.absoluteRect().x()),n.forEach(function(t){t.sketchObject.setConstrainProportions(0);var e=randomAspectRatio(),n=getDelta(t,o,i),r=t.frame;r.x+=n.x,r.y+=n.y,options.isRowLayout?(r.width=Math.round(r.height*e),o+=r.width+options.padding):(r.height=Math.round(r.width/e),i+=r.height+options.padding),t.frame=r})}function randomAspectRatio(){return aspectRatios[Math.floor(Math.random()*aspectRatios.length)]}function fitLayersInRows(t,e,n){var o=e.x,i=e.x+e.width,r=t.sort(function(t,e){return t.sketchObject.absoluteRect().x()-e.sketchObject.absoluteRect().x()}),a=r[r.length-1],s=Math.round(median(t.map(function(t){return t.frame.height}))),c=(i-o)/(t.map(function(t){return t.frame.width*s/t.frame.height}).reduce(function(t,e){return t+e})+(t.length-1)*options.padding),u=o;r.forEach(function(t){t.sketchObject.setConstrainProportions(0);var e=getDelta(t,u,n),o=t.frame;o.x+=e.x,o.y+=e.y,o.width=Math.round(o.width*s/o.height*c),o.height=Math.round(s*c),u+=o.width+options.padding,t.frame=o});var d=a.frame;d.width=i-a.sketchObject.absoluteRect().x(),a.frame=d}function fitLayersInColumns(t,e,n){var o=e.y,i=e.y+e.height,r=t.sort(function(t,e){return t.sketchObject.absoluteRect().y()-e.sketchObject.absoluteRect().y()}),a=r[r.length-1],s=Math.round(median(t.map(function(t){return t.frame.width}))),c=(i-o)/(t.map(function(t){return t.frame.height*s/t.frame.width}).reduce(function(t,e){return t+e})+(t.length-1)*options.padding),u=o;r.forEach(function(t){t.sketchObject.setConstrainProportions(0);var e=getDelta(t,n,u),o=t.frame;o.x+=e.x,o.y+=e.y,o.height=Math.round(o.height*s/o.width*c),o.width=Math.round(s*c),u+=o.height+options.padding,t.frame=o});var d=a.frame;d.height=i-a.sketchObject.absoluteRect().y(),a.frame=d}function getDelta(t,e,n){var o=t.sketchObject.absoluteRect();return{x:e-o.x(),y:n-o.y()}}function findGroups(t){var e,n=[],o=new Set(t);e=options.isRowLayout?Math.round(median(t.map(function(t){return t.frame.height}))):Math.round(median(t.map(function(t){return t.frame.width})));for(var i=function(){var t=[];o.forEach(function(n){var i=findLayersInGroup(o,n,e);i.length>t.length&&(t=i)}),t.forEach(function(t){o.delete(t)}),n.push(t)};o.size>0;)i();return options.isRowLayout?n.sort(function(t,e){return t[0].sketchObject.absoluteRect().y()-e[0].sketchObject.absoluteRect().y()}):n.sort(function(t,e){return t[0].sketchObject.absoluteRect().x()-e[0].sketchObject.absoluteRect().x()})}function findLayersInGroup(t,e,n){var o=[],i=getLayerCentre(e);if(options.isRowLayout){var r=i.y-n/2,a=i.y+n/2;t.forEach(function(t){var e=getLayerCentre(t);e.y>r&&e.y<a&&o.push(t)})}else{var s=i.x-n/2,c=i.x+n/2;t.forEach(function(t){var e=getLayerCentre(t);e.x>s&&e.x<c&&o.push(t)})}return o}function median(t){t.sort(function(t,e){return t-e});var e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2}function getBoundingBox(t){var e=t.map(function(t){return t.sketchObject.absoluteRect().x()}).sort(function(t,e){return t-e}),n=t.map(function(t){return t.sketchObject.absoluteRect().x()+t.frame.width}).sort(function(t,e){return t-e}),o=t.map(function(t){return t.sketchObject.absoluteRect().y()}).sort(function(t,e){return t-e}),i=t.map(function(t){return t.sketchObject.absoluteRect().y()+t.frame.height}).sort(function(t,e){return t-e});return{x:e[0],y:o[0],width:n[t.length-1]-e[0],height:i[t.length-1]-o[0]}}function getLayerCentre(t){return{x:t.sketchObject.absoluteRect().x()+t.frame.width/2,y:t.sketchObject.absoluteRect().y()+t.frame.height/2}}function createDialog(){var t=NSAlert.alloc().init();t.setMessageText("Photo Grid Settings"),t.addButtonWithTitle("Ok"),t.addButtonWithTitle("Cancel");var e=NSView.alloc().initWithFrame(NSMakeRect(0,0,360,250));t.setAccessoryView(e);var n=createTextField("Choose row or column layout and set the layer spacing. Photo Grid will try to keep layers in existing rows or columns.",NSMakeRect(0,210,350,40)),o=createTextField("Spacing:",NSMakeRect(0,180,200,20)),i=createTextField("Layout:",NSMakeRect(0,115,200,20)),r=createTextField("Scale and Fit Rows to Fixed Width:",NSMakeRect(0,50,350,20));form.spacingTextField=NSTextField.alloc().initWithFrame(NSMakeRect(0,155,70,20)),form.maxWidthTextField=NSTextField.alloc().initWithFrame(NSMakeRect(90,25,70,20)),form.rowsRadioButton=createRadioButton("Rows →",NSMakeRect(0,90,90,20)),form.columnsRadioButton=createRadioButton("Columns ↓",NSMakeRect(80,90,90,20)),form.hasWidthLimitCheckbox=createCheckbox("On",NSMakeRect(0,25,90,20)),form.spacingTextField.setStringValue(String(options.padding)),form.maxWidthTextField.setStringValue(String(options.maxWidth)),options.hasWidthLimit?form.hasWidthLimitCheckbox.setState(NSOnState):form.maxWidthTextField.setEnabled(!1),options.isRowLayout?form.rowsRadioButton.setState(NSOnState):(form.columnsRadioButton.setState(NSOnState),form.hasWidthLimitCheckbox.setEnabled(!1),form.maxWidthTextField.setEnabled(!1)),form.hasWidthLimitCheckbox.setCOSJSTargetFunction(function(t){form.maxWidthTextField.setEnabled(t.state()===NSOnState)});var a=function(t){var e=t===form.rowsRadioButton,n=form.hasWidthLimitCheckbox.state()===NSOnState;e?(form.hasWidthLimitCheckbox.setEnabled(!0),form.maxWidthTextField.setEnabled(n)):(form.hasWidthLimitCheckbox.setEnabled(!1),form.maxWidthTextField.setEnabled(!1))};return form.rowsRadioButton.setCOSJSTargetFunction(function(t){return a(t)}),form.columnsRadioButton.setCOSJSTargetFunction(function(t){return a(t)}),e.addSubview(n),e.addSubview(o),e.addSubview(i),e.addSubview(r),e.addSubview(form.spacingTextField),e.addSubview(form.maxWidthTextField),e.addSubview(form.rowsRadioButton),e.addSubview(form.columnsRadioButton),e.addSubview(form.hasWidthLimitCheckbox),t}function createTextField(t,e){var n=NSTextField.alloc().initWithFrame(e);return n.setStringValue(t),n.setSelectable(!1),n.setEditable(!1),n.setBezeled(!1),n.setDrawsBackground(!1),n}function createCheckbox(t,e){var n=NSButton.alloc().initWithFrame(e);return n.setButtonType(NSSwitchButton),n.setBezelStyle(0),n.setTitle(t),n}function createRadioButton(t,e){var n=NSButton.alloc().initWithFrame(e);return n.setButtonType(NSRadioButton),n.setTitle(t),n}},"sketch/dom":
/*!*****************************!*\
  !*** external "sketch/dom" ***!
  \*****************************/
/*! no static exports found */function(t,e){t.exports=require("sketch/dom")},"sketch/settings":
/*!**********************************!*\
  !*** external "sketch/settings" ***!
  \**********************************/
/*! no static exports found */function(t,e){t.exports=require("sketch/settings")},"sketch/ui":
/*!****************************!*\
  !*** external "sketch/ui" ***!
  \****************************/
/*! no static exports found */function(t,e){t.exports=require("sketch/ui")}});"default"===key&&"function"==typeof exports?exports(context):exports[key](context)}that.onRandomizeAspectRatios=__skpm_run.bind(this,"onRandomizeAspectRatios"),that.onRun=__skpm_run.bind(this,"default"),that.onFit=__skpm_run.bind(this,"onFit"),that.onSettings=__skpm_run.bind(this,"onSettings");